<!doctype html> <!--[if IE 9]>
<html class="no-js ie9" lang="en">
   <![endif]-->
   <html class="no-js" lang="en">
      <head>
         <meta charset="utf-8"/>
         <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
         <link rel="shortcut icon" href="http://neo4j.com/wp-content/themes/neo4jzurb/favicon.ico"/>
         <title>Tutorial: Import Data Into Neo4j | Developer Resources | Neo4j Graph Database</title>
         <link rel="canonical" href="http://neo4j.com/guides/basic-data-modeling/"/>
         <meta property="og:locale" content="en_US"/>
         <meta property="og:type" content="article"/>
         <meta property="og:site_name" content="Neo4j Graph Database"/>
         <link rel="alternate" type="application/rss+xml" title="Neo4j Graph Database &raquo; Feed" href="http://neo4j.com/feed/"/>
         <link rel="alternate" type="application/rss+xml" title="Neo4j Graph Database &raquo; Comments Feed" href="http://neo4j.com/comments/feed/"/>
         <link rel="alternate" type="application/rss+xml" title="Neo4j Graph Database &raquo; Basic Data Modeling Comments Feed" href="http://neo4j.com/guides/basic-data-modeling/feed/"/>
         <link rel='stylesheet' id='font-awesome-four-css' href="http://neo4j.com/wp-content/plugins/font-awesome-4-menus/css/font-awesome.min.css?ver=4.1.0" type='text/css' media='all'/>
         <link rel='stylesheet' id='foundation-css' href="http://neo4j.com/wp-content/themes/neo4jzurb/assets/css/app.css?ver=4.0.0" type='text/css' media='screen'/>
         <link rel='stylesheet' id='neo-codemirror-css' href="http://neo4j.com/wp-content/themes/neo4jzurb/assets/css/codemirror-neo.css?ver=4.0.0" type='text/css' media='screen'/>
         <script type='text/javascript'>
            /* <![CDATA[ */
            var ajax_object = {"ajaxurl":"http:\/\/neo4j.com\/wp-admin\/admin-ajax.php"};
            /* ]]> */
         </script> <script type='text/javascript' src='http://neo4j.com/wp-content/plugins/neo4j-download/js/download.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/plugins/jquery-updater/js/jquery-2.1.0.min.js?ver=2.1.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/vendor/modernizr.min.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/foundation.min.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/vendor/codemirror.min.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/neo_codemirror.js?ver=4.0.0'></script> <script type='text/javascript' src='//use.typekit.net/rdt4xku.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/misc.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/neo_calculator_v3.js?ver=4.0.0'></script>
         <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://neo4j.com/xmlrpc.php?rsd"/>
         <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://neo4j.com/wp-includes/wlwmanifest.xml"/>
         <meta name="generator" content="WordPress 3.9.2"/>
         <link rel='shortlink' href="http://neo4j.com/?p=32079"/>
         <style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
      </head>
      <body>
         <div class="off-canvas-wrap">
            <div class="inner-wrap">
               <aside class="left-off-canvas-menu">
                  <ul class="off-canvas-list">
                     <li><a href="http://neo4j.com/use-cases/">Use Cases</a></li>
                     <li><a href="http://neo4j.com/customers/">Customers</a></li>
                     <li><a href="http://neo4j.com/community/">Community</a></li>
                     <li><a href="http://neo4j.com/docs/">Docs</a></li>
                     <li>
                        <div class="medium-3 columns headspace-20">
                           <div class="row collapse">
                              <div class="small-10 columns">
                                 <form role="search" method="get" id="searchform" class="searchform" action="http://neo4j.com/">
                                    <input type="text" name="s" id="s"/>
                              </div>
                              <div class="small-2 columns"> <div class="button postfix"> <input type="image" id="searchsubmit" src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/searchicon.png" style="vertical-align:middle;"/> </form> </div> </div>
                           </div>
                        </div>
                     </li>
                  </ul>
               </aside>
               <div class="marquee">
                  <div class="navigation">
                     <div class="navigation-large hide-for-small">
                        <div class="row">
                           <div class="medium-9 large-7 columns nav-list">
                              <ul class="inline-list">
                                 <li><a href="http://neo4j.com/index.php"><img src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/logo-neo4j.svg" class="logo" alt="neo4j"></a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/use-cases/">Use Cases</a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/customers/">Customers</a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/community/">Community</a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/docs/">Docs</a></li>
                              </ul>
                           </div>
                           <div class="medium-3 large-3 columns nav-search">
                              <div class="row collapse">
                                 <div class="small-10 columns">
                                    <form role="search" method="get" id="searchform" class="searchform" action="http://neo4j.com/">
                                       <input type="text" name="s" id="s"/>
                                 </div>
                                 <div class="small-2 columns"> <div class="button postfix"> <input type="image" id="searchsubmit" src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/searchicon.png" style="vertical-align:middle;"/> </form> </div> </div>
                              </div>
                           </div>
                           <div class="large-2 columns show-for-large-up"> <a href="http://neo4j.com/download/" class="tiny small button right">Download</a> </div>
                        </div>
                     </div>
                     <nav class="tab-bar show-for-small">
                        <section class="left-small"> <a class="left-off-canvas-toggle menu-icon"><span></span></a> </section>
                        <section class="middle tab-bar-section"> <img src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/logo-neo4j.svg" class="logo" alt="neo4j" </section>
                     </nav>
                  </div>
                  <div class="row text-center">
                     <div class="medium-10 small-centered columns">
                        <h1 class="hero-title">Developer Resources</h1>
                        <h2 class="subheader"></h2>
                     </div>
                  </div>
               </div>
               <article id="content" role="main">
                  <style>
                    .side-nav li a:not(.button) { 
                       display:inline;
	                 }
                    .row { max-width: 62.5rem !important; }
                     .lead
                     {
                     display: none;
                     }
                     section.row
                     {
                     padding: 0;
                     }
                     #content section.row
                     {
                     padding-left: .5em;
                     padding-right: .5em;
                     }
                     .row
                     {
                     }
                     #content section.row .accordion-navigation > a {
                     background: none repeat scroll 0 0 rgba(0, 0, 0, 0) !important;
                     padding: 0 !important;
                     }
                     .accordion .content { padding: 0; }
                     .row .row { margin: auto; }
                     .columns.medium-12
                     {
                     padding-left: 0;
                     }
                     div.side-nav {
                        clear: right; float: right; margin-bottom: 1em; margin-top: 1em; width: 5em; padding: 1em; min-width: 16em; border: 1px solid rgb(222, 222, 222); height:auto;
                     }
                  </style>
                  <style> .lead { display: none; } section.row { padding: 0; } #content section.row { max-width: 62.5rem; padding-left: .5em; padding-right: .5em; } .row { max-width: 80em; } #content section.row .accordion-navigation > a { padding: 0 !important; } .accordion .content { padding: 0; } .row .row { margin: auto; } .columns.medium-12 { padding-left: 0; } .fa-stack.fa-lg { color: #0f5788; display: block; float: left; height: 70px; margin-right: 1em; padding-right: 2em; width: 50px; } h3 { font-weight: normal; } strong, b { font-weight:600; font-color:#333; } .calloutsection { padding: 20px 0; } section { padding: 40px 0 0 0; } .marquee { height: auto; margin-top: 1em; } #main-content .entry-title { display: none; } #main-content .subheader { display: none; } .marquee h1, .marquee h2 { padding-top: 0; } #main-content .next-steps h5 { font-size: 12px; } #main-content .next-steps h3 { margin-bottom: 1em; } #main-content .content.active { display: block; } #main-content .content { display: none; } #main-content { padding-top: 0; } .use-case .tab-container .content.active { border-top: 1px solid rgba(15, 87, 136, 0.7); padding: 2em 1em 1em; } .tabs dd > a:hover { color: #3d5360; } .breadcrumbs > * a, .breadcrumbs > * span { color: #0f5788; text-transform: none; } .breadcrumbs > * { text-transform: none; } .top-bar { height: 80px; } #main-content .top-bar-section ul { margin-top: 1em; } .panel-pod p { font-size: 14px; font-weight: normal; line-height: 26px; } .panel-pod > a { display: block; margin-bottom: 1em; } .panel-pod p a { display: block; margin-top: 1em; } .panel-pod { text-align: left; } .tab-container { margin-bottom: 2em; } .panel-pod img { display: block; margin: auto; } #content h3 { font-weight: 100; } #content ul {}
                  #content section.row .accordion-navigation > a {
                      background: url("http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/collapse.png") no-repeat scroll 100% 50% transparent;
                      border-bottom: 1px dashed #ddd;
                      padding: 0 !important;
                  }
                  .accordion-navigation.active > a {
                      background: url("http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/roll-up.png") no-repeat scroll 100% 50% transparent !important;
                  }

                  .accordion-navigation h5 {
                      font-weight: 100;
                      height: 2em;
                      line-height: 2em;
                      margin: 0;
                  }

                  .content ul {
                  margin-top: 1em;
                  }

                  .breadcrumbs>*:before {
                     content: "→";
                     color: #aaa;
                     margin: 0 0.75rem;
                     position: relative;
                     top: 0;
                     }

                  #content code
                  {
                   font-weight: 100;
                  }

                  #content h3
                  {
                   margin-bottom: .5em;
                  }

                  #content h5
                  {
                   font-weight: 100;
                  }

                  #content h4
                  {
                   font-weight: 400;
                  }

                  #content strong
                  {
                   font-weight: 400;
                  }

                  #content h4
                  {
                   margin-bottom: 1em;
                  }

                  #content .title {
                      font-size: 20px;
                  }

                  #content .breadcrumbs { margin-bottom: 0; }
                  </style>
                  <div style="padding-left: 1em; padding-right: 1em;">
                     <div class="row" style="padding: 10px;">
                        <div class="columns large-12" style="padding:10px 0 0;">
                           <ul class="breadcrumbs">
                              <li><a href="/developer-resources">Developer Guides</a></li>
                              <li><a href="../">Data Import</a></li>
                              <li class="current"><a href="#">Tutorial: Import Data Into Neo4j</a></li>
                           </ul>
                        </div>
                     </div>
                     <!-- <div class="row">
                        <div class="columns large-12">
                           <h1 style="font-size:2.1rem;">Tutorial: Import Data Into Neo4j</h1>
                        </div>
                     </div> -->
                     <section class="row" style="padding:10px 0;">
                        <div class="large-12 columns" style="padding-top:0;">
                           <div id="content">
                              <div id="preamble columns medium-12">
<div class="sectionbody">
<div class="quoteblock abstract">
<div class="title">Goals</div>
<blockquote style="padding-left: 0;">
This guide explores how to export data from a PostgreSQL database (RDBMS) for import into Neo4j (GraphDB). You&#8217;ll learn how to take a relational database schema and model it as a graph, for import into Neo4j.
</blockquote>
</div>
<div class="quoteblock abstract">
<div class="title">Prerequisites</div>
<blockquote style="padding-left: 0;">
You should have a basic understanding of the <a href="/developer/graph-database#property-graph">property graph model</a> and have completed the <a href="/developer/guide-data-modeling">modeling guide</a>.
If you <a href="/download">download</a> and install the Neo4j server you&#8217;ll be able to follow along with the examples.
</blockquote>
</div>


<div class="label">Beginner</div>
<hr/>

<div class="toc">
<h3 class="title">Overview</h3>

<ul class="sectlevel2">
<li><a href="#_northwind_introduction">NorthWind Introduction</a></li>
<li><a href="#_developing_a_graph_model">Developing a Graph Model</a></li>
<li><a href="#_exporting_the_data_to_csv">Exporting the Data to CSV</a></li>
<li><a href="#_importing_the_data_using_cypher">Importing the Data using Cypher</a></li>
<li><a href="#_querying_the_graph">Querying the Graph</a></li>
</ul>

</div>
<hr>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
<h3 id="_northwind_introduction">NorthWind Introduction</h3>


<div class="paragraph">
<p>In this guide we&#8217;ll be using the <a href="https://code.google.com/p/northwindextended/downloads/detail?name=northwind.postgre.sql&amp;can=2&amp;q=">NorthWind dataset</a>, a commonly used SQL dataset.
Although the NorthWind dataset is often used to demonstrate SQL and relational databases, it is graphy enough to be interesting for us.</p>
</div>



<div class="paragraph">
<p>The following is an entity relationship diagram of the NorthWind dataset:</p>
</div>

<div class="imageblock">
<p class="content">
<img src="http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/Northwind_diagram.jpg" alt="Northwind diagram">
</p>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
<h3 id="_developing_a_graph_model">Developing a Graph Model</h3>


<div class="paragraph">
<p>When deriving a graph model from a relational model, we should keep the following guidelines in mind:</p>
</div>

<div class="ulist">
<ul>
<li>
A <em>row</em> is a <em>node</em>
</li>
<li>
A <em>table name</em> is a <em>label name</em>
</li>
</ul>
</div>


<div class="paragraph">
<p>In this dataset, the following graph model serves as a first iteration:</p>
</div>

<div class="imageblock">
<p class="content">
<img src="http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/northwind_graph_simple.png" alt="northwind graph simple" width="800">
</p>
</div>
<div class="sect3 "  >
<h4 id="_how_does_the_graph_model_differ_from_the_relational_model">How does the Graph Model Differ from the Relational Model?</h4>
<div class="ulist">
<ul>
<li>
There are no nulls. In the relational version, to track the employee hierarchy we have a null entry in the 'ReportsTo' column if they don&#8217;t report to anybody. In the graph version we just don&#8217;t define a relationship.
</li>
<li>
It describes the relationships in more detail. For example, we know that an employee SOLD an order rather than having a foreign key relationship between the Orders and Employees tables. We could also choose to add more metadata about that relationship should we wish.
</li>
<li>
It will often be more normalised. For example, addresses have been denormalised in several of the tables but in a future version of the graph model we might choose to make addresses nodes in their own rights.
</li>
</ul>
</div>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
<h3 id="_exporting_the_data_to_csv">Exporting the Data to CSV</h3>


<div class="paragraph">
<p>Now that we know what we&#8217;d like our graph to look like, we need to extract the data from PostgreSQL so we can create it as a graph.
The easiest way to do that is to export the appropriate tables in CSV format.
The PostgreSQL 'copy' command lets us execute a SQL query and write the result to a CSV file, e.g. with <code>psql -d northwind &lt; export_csv.sql</code>:</p>
</div>

<div class="listingblock">
<div class="title">export_csv.sql</div>
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="sql"><code>COPY (SELECT * FROM customers) TO '/tmp/customers.csv' WITH CSV header;
COPY (SELECT * FROM suppliers) TO '/tmp/suppliers.csv' WITH CSV header;
COPY (SELECT * FROM products)  TO '/tmp/products.csv' WITH CSV header;
COPY (SELECT * FROM employees) TO '/tmp/employees.csv' WITH CSV header;
COPY (SELECT * FROM categories) TO '/tmp/categories.csv' WITH CSV header;

COPY (SELECT * FROM orders
      LEFT OUTER JOIN order_details ON order_details.OrderID = orders.OrderID) TO '/tmp/orders.csv' WITH CSV header;</code></pre>
</div>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
<h3 id="_importing_the_data_using_cypher">Importing the Data using Cypher</h3>


<div class="paragraph">
<p>After we&#8217;ve exported our data from PostgreSQL, we&#8217;ll use Cypher&#8217;s <a href="http://neo4j.com/docs/stable/query-load-csv.html">LOAD CSV</a> command to transform the contents of the CSV file into a graph structure.</p>
</div>



<div class="paragraph">
<p>First, create the nodes:</p>
</div>

<div class="listingblock">
<div class="title">import_csv.cypher</div>
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>// Create customers
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:customers.csv" AS row
CREATE (:Customer {companyName: row.CompanyName, customerID: row.CustomerID, fax: row.Fax, phone: row.Phone});

// Create products
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:products.csv" AS row
CREATE (:Product {productName: row.ProductName, productID: row.ProductID, unitPrice: toFloat(row.UnitPrice)});

// Create suppliers
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:suppliers.csv" AS row
CREATE (:Supplier {companyName: row.CompanyName, supplierID: row.SupplierID});

// Create employees
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:employees.csv" AS row
CREATE (:Employee {employeeID:row.EmployeeID,  firstName: row.FirstName, lastName: row.LastName, title: row.Title});

// Create categories
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:categories.csv" AS row
CREATE (:Category {categoryID: row.CategoryID, categoryName: row.CategoryName, description: row.Description});

USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:orders.csv" AS row
MERGE (order:Order {orderID: row.OrderID}) ON CREATE SET order.shipName =  row.ShipName;</code></pre>
</div>
</div>


<div class="paragraph">
<p>Next, we&#8217;ll create indexes on the just-created nodes to ensure their quick lookup when creating relationships in the next step.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>CREATE INDEX ON :Product(productID);
CREATE INDEX ON :Product(productName);
CREATE INDEX ON :Category(categoryID);
CREATE INDEX ON :Employee(employeeID);
CREATE INDEX ON :Supplier(supplierID);
CREATE INDEX ON :Customer(customerID);
CREATE INDEX ON :Customer(customerName);</code></pre>
</div>
</div>


<div class="paragraph">
<p>Initial nodes and indices in place, we can now create relationships of orders to products and employees:</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:orders.csv" AS row
MATCH (order:Order {orderID: row.OrderID})
MATCH (product:Product {productID: row.ProductID})
MERGE (order)-[pu:PRODUCT]-&gt;(product)
ON CREATE SET pu.unitPrice = toFloat(row.UnitPrice), pu.quantity = toFloat(row.Quantity);

USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:orders.csv" AS row
MATCH (order:Order {orderID: row.OrderID})
MATCH (employee:Employee {employeeID: row.EmployeeID})
MERGE (employee)-[:SOLD]-&gt;(order);

USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:orders.csv" AS row
MATCH (order:Order {orderID: row.OrderID})
MATCH (customer:Customer {customerID: row.CustomerID})
MERGE (customer)-[:PURCHASED]-&gt;(order);</code></pre>
</div>
</div>


<div class="paragraph">
<p>Next, create relationships between products, suppliers, and categories:</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:products.csv" AS row
MATCH (product:Product {productID: row.ProductID})
MATCH (supplier:Supplier {supplierID: row.SupplierID})
MERGE (supplier)-[:SUPPLIES]-&gt;(product);

USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:products.csv" AS row
MATCH (product:Product {productID: row.ProductID})
MATCH (category:Category {categoryID: row.CategoryID})
MERGE (product)-[:PART_OF]-&gt;(category);</code></pre>
</div>
</div>


<div class="paragraph">
<p>Finally we&#8217;ll create the 'REPORTS_TO' relationship between employees to represent the reporting structure:</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM "file:employees.csv" AS row
MATCH (employee:Employee {employeeID: row.EmployeeID})
MATCH (manager:Employee {employeeID: row.ReportsTo})
MERGE (employee)-[:REPORTS_TO]-&gt;(manager);</code></pre>
</div>
</div>


<div class="paragraph">
<p>For completeness and optimal query speed, create an unique constraint on orders:</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>CREATE CONSTRAINT ON (o:Order) ASSERT o.orderID IS UNIQUE;</code></pre>
</div>
</div>


<div class="paragraph">
<p>You can also run the whole script at once using <code>bin/neo4j-shell -path northwind.db -file import_csv.cypher</code>.</p>
</div>



<div class="paragraph">
<p>The resulting graph should look like this:</p>
</div>

<div class="imageblock">
<p class="content">
<img src="http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/northwind_graph_sample.png" alt="northwind graph sample">
</p>
</div>


<div class="paragraph">
<p>We can now query the resulting graph.</p>
</div>

</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
<h3 id="_querying_the_graph">Querying the Graph</h3>


<div class="paragraph">
<p>One question we might be interested in is:</p>
</div>

<div class="sect3 "  >
<h4 id="_which_employee_had_the_highest_cross_selling_count_of_chocolade_and_which_product">Which Employee had the Highest Cross-Selling Count of 'Chocolade' and Which Product?</h4>
<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (choc:Product {productName:'Chocolade'})&lt;-[:PRODUCT]-(:Order)&lt;-[:SOLD]-(employee),
      (employee)-[:SOLD]-&gt;(o2)-[:PRODUCT]-&gt;(other:Product)
RETURN employee.employeeID, other.productName, count(distinct o2) as count
ORDER BY count DESC
LIMIT 5;</code></pre>
</div>
</div>


<div class="paragraph">
<p>Looks like employee #1 was very busy!</p>
</div>

<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">employee.employeeId</th>
<th class="tableblock halign-left valign-top">other.productName</th>
<th class="tableblock halign-left valign-top">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pavlova</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">56</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Camembert Pierrot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">56</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ikura</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">55</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chang</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pâté chinois</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p>We might also like to answer the following question:</p>
</div>

</div>
<div class="sect3 "  >
<h4 id="_how_are_employees_organized_who_reports_to_whom">How are Employees Organized? Who Reports to Whom?</h4>
<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH path = (e:Employee)&lt;-[:REPORTS_TO]-(sub)
RETURN e.employeeID AS manager, sub.employeeID AS employee;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">manager</th>
<th class="tableblock halign-left valign-top">employee</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p>Notice that employee #5 has people reporting to them but also reports to employee #2.</p>
</div>



<div class="paragraph">
<p>Let&#8217;s investigate that a bit more:</p>
</div>

</div>
<div class="sect3 "  >
<h4 id="_which_employees_report_to_each_other_indirectly">Which Employees Report to Each Other Indirectly?</h4>
<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH path = (e:Employee)&lt;-[:REPORTS_TO*]-(sub)
WITH e, sub, [person in NODES(path) | person.employeeID][1..-1] AS path
RETURN e.employeeID AS manager, sub.employeeID AS employee, CASE WHEN LENGTH(path) = 0 THEN "Direct Report" ELSE path END AS via
ORDER BY LENGTH(path);</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">e.EmployeeID</th>
<th class="tableblock halign-left valign-top">sub.EmployeeID</th>
<th class="tableblock halign-left valign-top">via</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Report</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[5]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[5]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[5]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3 "  >
<h4 id="_how_many_orders_were_made_by_each_part_of_the_hierarchy">How Many Orders were Made by Each Part of the Hierarchy?</h4>
<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (e:Employee)
OPTIONAL MATCH (e)&lt;-[:REPORTS_TO*0..]-(sub)-[:SOLD]-&gt;(order)
RETURN e.employeeID, [x IN COLLECT(DISTINCT sub.employeeID) WHERE x &lt;&gt; e.employeeID] AS reports, COUNT(distinct order) AS totalOrders
ORDER BY totalOrders DESC;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">e.EmployeeID</th>
<th class="tableblock halign-left valign-top">reports</th>
<th class="tableblock halign-left valign-top">totalOrders</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[1,3,4,5,6,7,9,8]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2155</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[6,7,9]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">568</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">420</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">345</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">321</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">260</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">176</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">168</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">107</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<a href="https://github.com/neo4j-contrib/developer-resources/tree/gh-pages/data/northwind">Northwind SQL, CSV and Cypher data files</a>
</li>
<li>
<a href="/developer/cypher-query-language/guide-sql-to-cypher">From SQL to Cypher</a>
</li>
<li>
<a href="/developer/working-with-data/guide-import-csv">Import CSV Guide</a>
</li>
<li>
<a href="/developer/build-a-graph-data-model/guide-intro-to-graph-modeling.adoc">Graph Data Modeling</a>
</li>
</ul>
</div>
</div>
</div>
                           </div>
                        </div>
                     </section>
                  </div>
               </article>
               <div class="row text-center hide-for-small hr-style">
                  <div class="medium-5 columns">
                     <hr>
                  </div>
                  <div class="medium-2 columns"> <object height="100%" width="100%" data="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/hr-image.svg" type="image/svg+xml"></object> </div>
                  <div class="medium-5 columns">
                     <hr>
                  </div>
               </div>
               <div class="row text-center show-for-small">
                  <div class="medium-12 columns">
                     <hr>
                  </div>
               </div>
               </article>
               <div class="calloutsection">
                  <div class="row">
                     <div class="medium-8 small-centered columns text-center">
                        <h3>Stay Connected</h3>
                        <p>Sign up to find out more about Neo4j's upcoming events &amp; meetups.</p>
                     </div>
                  </div>
                  <div class="row">
                     <div class="medium-6 small-centered columns">
                        <div class="row collapse">
                           <div class="small-8 columns">
                              <script src="//app-sjl.marketo.com/js/forms2/js/forms2.js"></script>
                              <form id="mktoForm_519"></form>
                              <script>MktoForms2.loadForm("//app-sjl.marketo.com", "773-GON-065", 519);</script>
                           </div>
                           <div class="small-4 columns"> <a href="#" id="signupbody" class="button postfix">Keep Me Connected &rsaquo;</a> </div>
                        </div>
                     </div>
                  </div>
               </div>
               <style> .mktoButtonWrap {display:none;} </style>
               <script>
                  var btn = document.getElementById("signupbody");
                  btn.onclick = function(){
                  MktoForms2.getForm(519).submit();
                  };
               </script>
               <div class="row text-center hide-for-small hr-style">
                  <div class="medium-5 columns">
                     <hr>
                  </div>
                  <div class="medium-2 columns"> <object height="100%" width="100%" data="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/hr-image.svg" type="image/svg+xml"></object> </div>
                  <div class="medium-5 columns">
                     <hr>
                  </div>
               </div>
               <div class="row text-center show-for-small">
                  <div class="medium-12 columns">
                     <hr>
                  </div>
               </div>
               <footer id="footer">
                  <div class="row">
                     <div class="small-6 medium-3 columns">
                        <h5>Learn & Try</h5>
                        <ul>
                           <li><a href="../about-neo4j">About Neo4j</a></li>
                           <li><a href="../graph-concepts/">Graph Concepts</a></li>
                           <li><a href="http://neo4j.com/use-cases/">Use Cases</a></li>
                           <li><a href="http://neo4j.com/customers/">Our Customers</a></li>
                           <li><a href="http://neo4j.com/download/">Download Neo4j</a></li>
                           <li><a href="http://console.neo4j.org/">Live Neo4j Console</a></li>
                           <li><a href="working-with-data/guide-neo4j-browser/">Neo4j Browser</a></li>
                           <li><a href="http://gist.neo4j.org">Graph Gists</a></li>
                        </ul>
                     </div>
                     <div class="small-6 medium-3 columns">
                        <h5>Develop</h5>
                        <ul>
                           <li><a href="http://neo4j.com/docs/">Docs</a></li>
                           <li><a href="../">Neo4j Guides</a></li>
                           <li><a href="working-with-data/guide-importing-data-and-etl">Import Data</a></li>
                           <li><a href="http://neo4j.com/contrib/">Select a Driver</a></li>
                           <li><a href="cypher-query-language/guide-cypher-basics">Cypher Query Language</a></li>
                           <li><a href="build-a-graph-data-model/guide-intro-to-graph-modeling">Data Modeling</a></li>
                        </ul>
                     </div>
                     <div class="small-6 medium-3 columns">
                        <h5>Connect with Neo4j</h5>
                        <ul>
                           <li><a href="http://neo4j.com/training/">Training</a></li>
                           <li><a href="http://neo4j.com/events/">Events</a></li>
                           <li><a href="http://neo4j.com/blog/">Blog</a></li>
                           <li><a href="http://neo4j.com/community/#support">Support</a></li>
                           <li><a href="http://neo4j.com/neo4j-partner-program/">Neo4j Partner Program</a></li>
                           <li><a href="http://neotechnology.com/about/">About Neo Technology</a></li>
                        </ul>
                     </div>
                     <div class="small-12 medium-3 columns">
                        <h5><a href="http://neo4j.com/contact-us">Contact Us &rarr;</a></h5>
                        <p>1-855-636-4532 <a href="mailto:info@neotechnology.com">US <i class="fi-mail"></i></a><br/> +44 808 189 0493 <a href="mailto:uk@neotechnology.com">UK <i class="fi-mail"></i></a><br/> +49 800 723 6231 <a href="mailto:vertrieb@neotechnology.com">Germany <i class="fi-mail"></i></a><br/> +33 (0)8 05 08 03 44 <a href="mailto:ventes@neotechnology.com">France <i class="fi-mail"></i></a></p>
                        <h5>Get Neo4j News</h5>
                        <p>Keep up with the latest graph database trends, tips &amp; events.</p>
                        <div class="row collapse">
                           <div class="small-9 columns">
                              <script src="//app-sjl.marketo.com/js/forms2/js/forms2.js"></script>
                              <form id="mktoForm_477"></form>
                              <script>MktoForms2.loadForm("//app-sjl.marketo.com", "773-GON-065", 477);</script>
                           </div>
                           <div class="small-3 columns"> <a href="#" id="signup" class="button postfix">Go &rsaquo;</a> </div>
                        </div>
                     </div>
                  </div>
               </footer>
               <style> #mktoForm_477 button {display:none;} #mktoForm_477 {margin-left:-20px;} </style>
               <script>
                  var btn = document.getElementById("signup");
                  btn.onclick = function(){
                    MktoForms2.getForm(477).submit();
                  };
               </script>
               <div class="row text-center hide-for-small hr-style">
                  <div class="medium-5 columns">
                     <hr>
                  </div>
                  <div class="medium-2 columns"> <object height="100%" width="100%" data="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/hr-image.svg" type="image/svg+xml"></object> </div>
                  <div class="medium-5 columns">
                     <hr>
                  </div>
               </div>
               <div class="row text-center show-for-small">
                  <div class="medium-12 columns">
                     <hr>
                  </div>
               </div>
               <div class="row collapse copyright">
                  <div class="small-12 medium-3 columns text-center">
                     <p>&copy; 2014 <a href="http://neotechnology.com/">Neo Technology, Inc.</a></p>
                  </div>
                  <div class="small-12 medium-6 columns text-center">
                     <code>&#40;graphs&#41;-&#91;&#58;ARE&#93;-&rsaquo;&#40;everywhere&#41;</code>
                     <p>With &hearts; from Sweden &amp; the <a href="http://neo4j.com/community/">Neo4j</a> Community</p>
                  </div>
                  <div class="small-12 medium-3 columns text-center">
                     <ul>
                        <li><a href="http://neo4j.com/terms">Terms</a></li>
                        <li><a href="http://neo4j.com/privacy-policy/">Privacy Policy</a></li>
                     </ul>
                  </div>
               </div>
               <a class="exit-off-canvas"></a>
            </div>
         </div>
         <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script type="text/javascript">mktoMunchkin("773-GON-065");</script> <script type='text/javascript' src='http://neo4j.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script> <script type='text/javascript' src='http://neo4j.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script> <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.2/d3.min.js?ver=3.9.2'></script> <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/json3/3.3.0/json3.min.js?ver=3.9.2'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/neo_d3.js?ver=3.9.2'></script> <script type='text/javascript' src='http://neo4j.com/wp-includes/js/comment-reply.min.js?ver=3.9.2'></script> <script>
            jQuery(document).foundation({
              tab: {
                callback : function (tab) {
                  $(window).trigger('resize');
                }
              }
            });
         </script> <script src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/js/foundation/foundation.equalizer.js"></script>
      </body>
      <script type="text/javascript" src="http://munchkin.marketo.net/munchkin.js"></script> <script type="text/javascript">
         mktoMunchkin("773-GON-065");
      </script>
   </html>